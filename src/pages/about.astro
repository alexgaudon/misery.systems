---
import { getRuntimeEnv } from "../lib/runtimeEnv";
import Layout from "./layout.astro";
const runtimeEnv = getRuntimeEnv();

// Map node names to their positions in the rack (percentage from top)
// Based on the rack image: GRIEF, DESPAIR, BLEAK, SORROW, GLOOM (top to bottom)
const nodePositions: Record<string, number> = {
	"k8s-worker-1": 63, // BLEAK (first ThinkCentre)
	"k8s-worker-2": 77, // DISTRESS (second ThinkCentre)
	"k8s-worker-3": 90, // SORROW (third ThinkCentre)
};

const displayNames: Record<string, string> = {
	"k8s-worker-1": "bleak",
	"k8s-worker-2": "distress",
	"k8s-worker-3": "sorrow",
	"???": "magic",
};

const topPosition = runtimeEnv.nodeName
	? (nodePositions[runtimeEnv.nodeName] ?? 50)
	: 50;
---

<Layout>
    <div class="grid grid-cols-1 md:grid-cols-2 gap-6 md:gap-8 items-start mb-8">
        <!-- Text Content -->
        <div>
            <h1 class="text-2xl font-semibold mb-2">About</h1>
            <p class="mb-4">
                <b class="font-semibold">misery.systems</b> is just my homelab.
            </p>
            <p class="mb-4">
                I run random stuff here and mess with kubernetes and linux.
            </p>
            <p>
                It's mostly for learning, breaking things, and fixing them (sometimes).
            </p>
        </div>
        
        <!-- Rack Image -->
        <div class="relative">
            <p class="text-sm text-stone-400 mb-2">This request was served by {displayNames[runtimeEnv.nodeName ?? '???']}.</p>
            <img
                src="/rack-min.jpg"
                alt="Homelab rack with servers" 
                class="w-full rounded-lg shadow-xl" 
                loading="eager" 
            />
            {runtimeEnv.nodeName && (
                <div 
                    class="absolute left-1/2 transform -translate-x-1/2 -translate-y-1/2 
                        bg-yellow-400 text-black px-2 py-1 
                        rounded shadow-md 
                        font-semibold text-xs 
                        border border-black
                        whitespace-nowrap
                        z-10"
                    style={`top: ${topPosition}%;`}
                >
                    &larr; You are here &rarr;
                </div>
            )}
        </div>
    </div>
</Layout>